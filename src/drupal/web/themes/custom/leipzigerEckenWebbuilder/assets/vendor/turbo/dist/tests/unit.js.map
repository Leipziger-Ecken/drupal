{"version":3,"file":"unit.js","sources":["../../src/elements/frame_element.ts","../../src/core/location.ts","../../src/http/fetch_response.ts","../../src/util.ts","../../src/http/fetch_request.ts","../../src/observers/appearance_observer.ts","../../src/core/drive/form_submission.ts","../../src/core/frames/form_interceptor.ts","../../src/core/frames/link_interceptor.ts","../../src/core/frames/frame_controller.ts","../../src/core/streams/stream_actions.ts","../../src/elements/stream_element.ts","../../src/elements/index.ts","../../src/tests/helpers/intern_test_case.ts","../../src/tests/helpers/dom_test_case.ts","../../src/tests/unit/stream_element_tests.ts"],"sourcesContent":["import { FetchResponse } from \"../http/fetch_response\"\n\nexport enum FrameLoadingStyle { eager = \"eager\", lazy = \"lazy\" }\n\nexport interface FrameElementDelegate {\n  connect(): void\n  disconnect(): void\n  loadingStyleChanged(): void\n  sourceURLChanged(): void\n  formSubmissionIntercepted(element: HTMLFormElement, submitter?: HTMLElement): void\n  loadResponse(response: FetchResponse): void\n  isLoading: boolean\n}\n\nexport class FrameElement extends HTMLElement {\n  static delegateConstructor: new (element: FrameElement) => FrameElementDelegate\n\n  loaded: Promise<FetchResponse | void> = Promise.resolve()\n  readonly delegate: FrameElementDelegate\n\n  static get observedAttributes() {\n    return [\"loading\", \"src\"]\n  }\n\n  constructor() {\n    super()\n    this.delegate = new FrameElement.delegateConstructor(this)\n  }\n\n  connectedCallback() {\n    this.delegate.connect()\n  }\n\n  disconnectedCallback() {\n    this.delegate.disconnect()\n  }\n\n  attributeChangedCallback(name: string) {\n    if (name == \"loading\") {\n      this.delegate.loadingStyleChanged()\n    } else if (name == \"src\") {\n      this.delegate.sourceURLChanged()\n    }\n  }\n\n  get src() {\n    return this.getAttribute(\"src\")\n  }\n\n  set src(value: string | null) {\n    if (value) {\n      this.setAttribute(\"src\", value)\n    } else {\n      this.removeAttribute(\"src\")\n    }\n  }\n\n  get loading(): FrameLoadingStyle {\n    return frameLoadingStyleFromString(this.getAttribute(\"loading\") || \"\")\n  }\n\n  set loading(value: FrameLoadingStyle) {\n    if (value) {\n      this.setAttribute(\"loading\", value)\n    } else {\n      this.removeAttribute(\"loading\")\n    }\n  }\n\n  get disabled() {\n    return this.hasAttribute(\"disabled\")\n  }\n\n  set disabled(value: boolean) {\n    if (value) {\n      this.setAttribute(\"disabled\", \"\")\n    } else {\n      this.removeAttribute(\"disabled\")\n    }\n  }\n\n  get autoscroll() {\n    return this.hasAttribute(\"autoscroll\")\n  }\n\n  set autoscroll(value: boolean) {\n    if (value) {\n      this.setAttribute(\"autoscroll\", \"\")\n    } else {\n      this.removeAttribute(\"autoscroll\")\n    }\n  }\n\n  get complete() {\n    return !this.delegate.isLoading\n  }\n\n  get isActive() {\n    return this.ownerDocument === document && !this.isPreview\n  }\n\n  get isPreview() {\n    return this.ownerDocument?.documentElement?.hasAttribute(\"data-turbo-preview\")\n  }\n}\n\nfunction frameLoadingStyleFromString(style: string) {\n  switch (style.toLowerCase()) {\n    case \"lazy\":  return FrameLoadingStyle.lazy\n    default:      return FrameLoadingStyle.eager\n  }\n}\n","export type Locatable = Location | string\n\nexport class Location {\n  static get currentLocation() {\n    return this.wrap(window.location.toString())\n  }\n\n  static wrap(locatable: Locatable): Location\n  static wrap(locatable?: Locatable | null): Location | undefined\n  static wrap(locatable: Locatable) {\n    if (typeof locatable == \"string\") {\n      return new this(locatable)\n    } else if (locatable != null) {\n      return locatable\n    }\n  }\n\n  readonly absoluteURL: string\n  readonly requestURL: string\n  readonly anchor?: string\n\n  constructor(url: string) {\n    const linkWithAnchor = document.createElement(\"a\")\n    linkWithAnchor.href = url\n\n    this.absoluteURL = linkWithAnchor.href\n\n    const anchorLength = linkWithAnchor.hash.length\n    if (anchorLength < 2) {\n      this.requestURL = this.absoluteURL\n    } else {\n      this.requestURL = this.absoluteURL.slice(0, -anchorLength)\n      this.anchor = linkWithAnchor.hash.slice(1)\n    }\n  }\n\n  getOrigin() {\n    return this.absoluteURL.split(\"/\", 3).join(\"/\")\n  }\n\n  getPath() {\n    return (this.requestURL.match(/\\/\\/[^/]*(\\/[^?;]*)/) || [])[1] || \"/\"\n  }\n\n  getPathComponents() {\n    return this.getPath().split(\"/\").slice(1)\n  }\n\n  getLastPathComponent() {\n    return this.getPathComponents().slice(-1)[0]\n  }\n\n  getExtension() {\n    return (this.getLastPathComponent().match(/\\.[^.]*$/) || [])[0] || \"\"\n  }\n\n  isHTML() {\n    return !!this.getExtension().match(/^(?:|\\.(?:htm|html|xhtml))$/)\n  }\n\n  isPrefixedBy(location: Location): boolean {\n    const prefixURL = getPrefixURL(location)\n    return this.isEqualTo(location) || stringStartsWith(this.absoluteURL, prefixURL)\n  }\n\n  isEqualTo(location?: Location) {\n    return location && this.absoluteURL === location.absoluteURL\n  }\n\n  toCacheKey() {\n    return this.requestURL\n  }\n\n  toJSON() {\n    return this.absoluteURL\n  }\n\n  toString() {\n    return this.absoluteURL\n  }\n\n  valueOf() {\n    return this.absoluteURL\n  }\n}\n\nfunction getPrefixURL(location: Location) {\n  return addTrailingSlash(location.getOrigin() + location.getPath())\n}\n\nfunction addTrailingSlash(url: string) {\n  return stringEndsWith(url, \"/\") ? url : url + \"/\"\n}\n\nfunction stringStartsWith(string: string, prefix: string) {\n  return string.slice(0, prefix.length) === prefix\n}\n\nfunction stringEndsWith(string: string, suffix: string) {\n  return string.slice(-suffix.length) === suffix\n}\n","import { Location } from \"../core/location\"\n\nexport class FetchResponse {\n  readonly response: Response\n\n  constructor(response: Response) {\n    this.response = response\n  }\n\n  get succeeded() {\n    return this.response.ok\n  }\n\n  get failed() {\n    return !this.succeeded\n  }\n\n  get clientError() {\n    return this.statusCode >= 400 && this.statusCode <= 499\n  }\n\n  get serverError() {\n    return this.statusCode >= 500 && this.statusCode <= 599\n  }\n\n  get redirected() {\n    return this.response.redirected\n  }\n\n  get location() {\n    return Location.wrap(this.response.url)\n  }\n\n  get isHTML() {\n    return this.contentType && this.contentType.match(/^(?:text\\/([^\\s;,]+\\b)?html|application\\/xhtml\\+xml)\\b/)\n  }\n\n  get statusCode() {\n    return this.response.status\n  }\n\n  get contentType() {\n    return this.header(\"Content-Type\")\n  }\n\n  get responseText(): Promise<string> {\n    return this.response.text()\n  }\n\n  get responseHTML(): Promise<string | undefined> {\n    if (this.isHTML) {\n      return this.response.text()\n    } else {\n      return Promise.resolve(undefined)\n    }\n  }\n\n  header(name: string) {\n    return this.response.headers.get(name)\n  }\n}\n","export type DispatchOptions = { target: EventTarget, cancelable: boolean, detail: any }\n\nexport function dispatch(eventName: string, { target, cancelable, detail }: Partial<DispatchOptions> = {}) {\n  const event = new CustomEvent(eventName, { cancelable, bubbles: true, detail })\n  void (target || document.documentElement).dispatchEvent(event)\n  return event\n}\n\nexport function nextAnimationFrame() {\n  return new Promise<void>(resolve => requestAnimationFrame(() => resolve()))\n}\n\nexport function nextMicrotask() {\n  return Promise.resolve()\n}\n\nexport function unindent(strings: TemplateStringsArray, ...values: any[]): string {\n  const lines = interpolate(strings, values).replace(/^\\n/, \"\").split(\"\\n\")\n  const match = lines[0].match(/^\\s+/)\n  const indent = match ? match[0].length : 0\n  return lines.map(line => line.slice(indent)).join(\"\\n\")\n}\n\nfunction interpolate(strings: TemplateStringsArray, values: any[]) {\n  return strings.reduce((result, string, i) => {\n    const value = values[i] == undefined ? \"\" : values[i]\n    return result + string + value\n  }, \"\")\n}\n\nexport function uuid() {\n  return Array.apply(null, { length: 36 } as any).map((_, i) => {\n    if (i == 8 || i == 13 || i == 18 || i == 23) {\n      return \"-\"\n    } else if (i == 14) {\n      return \"4\"\n    } else if (i == 19) {\n      return (Math.floor(Math.random() * 4) + 8).toString(16)\n    } else {\n      return Math.floor(Math.random() * 15).toString(16)\n    }\n  }).join(\"\")\n}\n","import { FetchResponse } from \"./fetch_response\"\nimport { Location } from \"../core/location\"\nimport { dispatch } from \"../util\"\n\nexport interface FetchRequestDelegate {\n  additionalHeadersForRequest?(request: FetchRequest): { [header: string]: string }\n  requestStarted(request: FetchRequest): void\n  requestPreventedHandlingResponse(request: FetchRequest, response: FetchResponse): void\n  requestSucceededWithResponse(request: FetchRequest, response: FetchResponse): void\n  requestFailedWithResponse(request: FetchRequest, response: FetchResponse): void\n  requestErrored(request: FetchRequest, error: Error): void\n  requestFinished(request: FetchRequest): void\n}\n\nexport enum FetchMethod {\n  get,\n  post,\n  put,\n  patch,\n  delete\n}\n\nexport function fetchMethodFromString(method: string) {\n  switch (method.toLowerCase()) {\n    case \"get\":    return FetchMethod.get\n    case \"post\":   return FetchMethod.post\n    case \"put\":    return FetchMethod.put\n    case \"patch\":  return FetchMethod.patch\n    case \"delete\": return FetchMethod.delete\n  }\n}\n\nexport type FetchRequestBody = FormData\n\nexport type FetchRequestHeaders = { [header: string]: string }\n\nexport interface FetchRequestOptions {\n  headers: FetchRequestHeaders\n  body: FetchRequestBody\n  followRedirects: boolean\n}\n\nexport class FetchRequest {\n  readonly delegate: FetchRequestDelegate\n  readonly method: FetchMethod\n  readonly location: Location\n  readonly body?: FetchRequestBody\n  readonly abortController = new AbortController\n\n  constructor(delegate: FetchRequestDelegate, method: FetchMethod, location: Location, body?: FetchRequestBody) {\n    this.delegate = delegate\n    this.method = method\n    this.location = location\n    this.body = body\n  }\n\n  get url() {\n    const url = this.location.absoluteURL\n    const query = this.params.toString()\n    if (this.isIdempotent && query.length) {\n      return [url, query].join(url.includes(\"?\") ? \"&\" : \"?\")\n    } else {\n      return url\n    }\n  }\n\n  get params() {\n    return this.entries.reduce((params, [name, value]) => {\n      params.append(name, value.toString())\n      return params\n    }, new URLSearchParams)\n  }\n\n  get entries() {\n    return this.body ? Array.from(this.body.entries()) : []\n  }\n\n  cancel() {\n    this.abortController.abort()\n  }\n\n  async perform(): Promise<FetchResponse> {\n    const { fetchOptions } = this\n    dispatch(\"turbo:before-fetch-request\", { detail: { fetchOptions } })\n    try {\n      this.delegate.requestStarted(this)\n      const response = await fetch(this.url, fetchOptions)\n      return await this.receive(response)\n    } catch (error) {\n      this.delegate.requestErrored(this, error)\n      throw error\n    } finally {\n      this.delegate.requestFinished(this)\n    }\n  }\n\n  async receive(response: Response): Promise<FetchResponse> {\n    const fetchResponse = new FetchResponse(response)\n    const event = dispatch(\"turbo:before-fetch-response\", { cancelable: true, detail: { fetchResponse } })\n    if (event.defaultPrevented) {\n      this.delegate.requestPreventedHandlingResponse(this, fetchResponse)\n    } else if (fetchResponse.succeeded) {\n      this.delegate.requestSucceededWithResponse(this, fetchResponse)\n    } else {\n      this.delegate.requestFailedWithResponse(this, fetchResponse)\n    }\n    return fetchResponse\n  }\n\n  get fetchOptions(): RequestInit {\n    return {\n      method: FetchMethod[this.method].toUpperCase(),\n      credentials: \"same-origin\",\n      headers: this.headers,\n      redirect: \"follow\",\n      body: this.isIdempotent ? undefined : this.body,\n      signal: this.abortSignal\n    }\n  }\n\n  get isIdempotent() {\n    return this.method == FetchMethod.get\n  }\n\n  get headers() {\n    return {\n      \"Accept\": \"text/html, application/xhtml+xml\",\n      ...this.additionalHeaders\n    }\n  }\n\n  get additionalHeaders() {\n    if (typeof this.delegate.additionalHeadersForRequest == \"function\") {\n      return this.delegate.additionalHeadersForRequest(this)\n    } else {\n      return {}\n    }\n  }\n\n  get abortSignal() {\n    return this.abortController.signal\n  }\n}\n","export interface AppearanceObserverDelegate {\n  elementAppearedInViewport(element: Element): void\n}\n\nexport class AppearanceObserver {\n  readonly delegate: AppearanceObserverDelegate\n  readonly element: Element\n  readonly intersectionObserver: IntersectionObserver\n  started = false\n\n  constructor(delegate: AppearanceObserverDelegate, element: Element) {\n    this.delegate = delegate\n    this.element = element\n    this.intersectionObserver = new IntersectionObserver(this.intersect)\n  }\n\n  start() {\n    if (!this.started) {\n      this.started = true\n      this.intersectionObserver.observe(this.element)\n    }\n  }\n\n  stop() {\n    if (this.started) {\n      this.started = false\n      this.intersectionObserver.unobserve(this.element)\n    }\n  }\n\n  intersect: IntersectionObserverCallback = entries => {\n    const lastEntry = entries.slice(-1)[0]\n    if (lastEntry?.isIntersecting) {\n      this.delegate.elementAppearedInViewport(this.element)\n    }\n  }\n}\n","import { FetchRequest, FetchMethod, fetchMethodFromString, FetchRequestHeaders } from \"../../http/fetch_request\"\nimport { FetchResponse } from \"../../http/fetch_response\"\nimport { Location } from \"../location\"\nimport { dispatch } from \"../../util\"\n\nexport interface FormSubmissionDelegate {\n  formSubmissionStarted(formSubmission: FormSubmission): void\n  formSubmissionSucceededWithResponse(formSubmission: FormSubmission, fetchResponse: FetchResponse): void\n  formSubmissionFailedWithResponse(formSubmission: FormSubmission, fetchResponse: FetchResponse): void\n  formSubmissionErrored(formSubmission: FormSubmission, error: Error): void\n  formSubmissionFinished(formSubmission: FormSubmission): void\n}\n\nexport type FormSubmissionResult\n  = { success: boolean, fetchResponse: FetchResponse }\n  | { success: false, error: Error }\n\nexport enum FormSubmissionState {\n  initialized,\n  requesting,\n  waiting,\n  receiving,\n  stopping,\n  stopped,\n}\n\nexport class FormSubmission {\n  readonly delegate: FormSubmissionDelegate\n  readonly formElement: HTMLFormElement\n  readonly submitter?: HTMLElement\n  readonly formData: FormData\n  readonly fetchRequest: FetchRequest\n  readonly mustRedirect: boolean\n  state = FormSubmissionState.initialized\n  result?: FormSubmissionResult\n\n  constructor(delegate: FormSubmissionDelegate, formElement: HTMLFormElement, submitter?: HTMLElement, mustRedirect = false) {\n    this.delegate = delegate\n    this.formElement = formElement\n    this.formData = buildFormData(formElement, submitter)\n    this.submitter = submitter\n    this.fetchRequest = new FetchRequest(this, this.method, this.location, this.formData)\n    this.mustRedirect = mustRedirect\n  }\n\n  get method(): FetchMethod {\n    const method = this.submitter?.getAttribute(\"formmethod\") || this.formElement.getAttribute(\"method\") || \"\"\n    return fetchMethodFromString(method.toLowerCase()) || FetchMethod.get\n  }\n\n  get action(): string {\n    return this.submitter?.getAttribute(\"formaction\") || this.formElement.action\n  }\n\n  get location() {\n    return Location.wrap(this.action)\n  }\n\n  // The submission process\n\n  async start() {\n    const { initialized, requesting } = FormSubmissionState\n    if (this.state == initialized) {\n      this.state = requesting\n      return this.fetchRequest.perform()\n    }\n  }\n\n  stop() {\n    const { stopping, stopped } = FormSubmissionState\n    if (this.state != stopping && this.state != stopped) {\n      this.state = stopping\n      this.fetchRequest.cancel()\n      return true\n    }\n  }\n\n  // Fetch request delegate\n\n  additionalHeadersForRequest(request: FetchRequest) {\n    const headers: FetchRequestHeaders = {}\n    if (this.method != FetchMethod.get) {\n      const token = getCookieValue(getMetaContent(\"csrf-param\")) || getMetaContent(\"csrf-token\")\n      if (token) {\n        headers[\"X-CSRF-Token\"] = token\n      }\n    }\n    return headers\n  }\n\n  requestStarted(request: FetchRequest) {\n    this.state = FormSubmissionState.waiting\n    dispatch(\"turbo:submit-start\", { target: this.formElement, detail: { formSubmission: this } })\n    this.delegate.formSubmissionStarted(this)\n  }\n\n  requestPreventedHandlingResponse(request: FetchRequest, response: FetchResponse) {\n    this.result = { success: response.succeeded, fetchResponse: response }\n  }\n\n  requestSucceededWithResponse(request: FetchRequest, response: FetchResponse) {\n    if (response.clientError || response.serverError) {\n      this.delegate.formSubmissionFailedWithResponse(this, response)\n    } else if (this.requestMustRedirect(request) && responseSucceededWithoutRedirect(response)) {\n      const error = new Error(\"Form responses must redirect to another location\")\n      this.delegate.formSubmissionErrored(this, error)\n    } else {\n      this.state = FormSubmissionState.receiving\n      this.result = { success: true, fetchResponse: response }\n      this.delegate.formSubmissionSucceededWithResponse(this, response)\n    }\n  }\n\n  requestFailedWithResponse(request: FetchRequest, response: FetchResponse) {\n    this.result = { success: false, fetchResponse: response }\n    this.delegate.formSubmissionFailedWithResponse(this, response)\n  }\n\n  requestErrored(request: FetchRequest, error: Error) {\n    this.result = { success: false, error }\n    this.delegate.formSubmissionErrored(this, error)\n  }\n\n  requestFinished(request: FetchRequest) {\n    this.state = FormSubmissionState.stopped\n    dispatch(\"turbo:submit-end\", { target: this.formElement, detail: { formSubmission: this, ...this.result }})\n    this.delegate.formSubmissionFinished(this)\n  }\n\n  requestMustRedirect(request: FetchRequest) {\n    return !request.isIdempotent && this.mustRedirect\n  }\n}\n\nfunction buildFormData(formElement: HTMLFormElement, submitter?: HTMLElement): FormData {\n  const formData = new FormData(formElement)\n  const name = submitter?.getAttribute(\"name\")\n  const value = submitter?.getAttribute(\"value\")\n\n  if (name && formData.get(name) != value) {\n    formData.append(name, value || \"\")\n  }\n\n  return formData\n}\n\nfunction getCookieValue(cookieName: string | null) {\n  if (cookieName != null) {\n    const cookies = document.cookie ? document.cookie.split(\"; \") : []\n    const cookie = cookies.find((cookie) => cookie.startsWith(cookieName))\n    if (cookie) {\n      const value = cookie.split(\"=\").slice(1).join(\"=\")\n      return value ? decodeURIComponent(value) : undefined\n    }\n  }\n}\n\nfunction getMetaContent(name: string) {\n  const element: HTMLMetaElement | null = document.querySelector(`meta[name=\"${name}\"]`)\n  return element && element.content\n}\n\nfunction responseSucceededWithoutRedirect(response: FetchResponse) {\n  return response.statusCode == 200 && !response.redirected\n}\n","export interface FormInterceptorDelegate {\n  shouldInterceptFormSubmission(element: HTMLFormElement, submitter?: HTMLElement): boolean\n  formSubmissionIntercepted(element: HTMLFormElement, submitter?: HTMLElement): void\n}\n\nexport class FormInterceptor {\n  readonly delegate: FormInterceptorDelegate\n  readonly element: Element\n\n  constructor(delegate: FormInterceptorDelegate, element: Element) {\n    this.delegate = delegate\n    this.element = element\n  }\n\n  start() {\n    this.element.addEventListener(\"submit\", this.submitBubbled)\n  }\n\n  stop() {\n    this.element.removeEventListener(\"submit\", this.submitBubbled)\n  }\n\n  submitBubbled = <EventListener>((event: SubmitEvent) => {\n    if (event.target instanceof HTMLFormElement) {\n      const form = event.target\n      const submitter = event.submitter || undefined\n      if (this.delegate.shouldInterceptFormSubmission(form, submitter)) {\n        event.preventDefault()\n        event.stopImmediatePropagation()\n        this.delegate.formSubmissionIntercepted(form, submitter)\n      }\n    }\n  })\n}\n","export interface LinkInterceptorDelegate {\n  shouldInterceptLinkClick(element: Element, url: string): boolean\n  linkClickIntercepted(element: Element, url: string): void\n}\n\nexport class LinkInterceptor {\n  readonly delegate: LinkInterceptorDelegate\n  readonly element: Element\n  private clickEvent?: Event\n\n  constructor(delegate: LinkInterceptorDelegate, element: Element) {\n    this.delegate = delegate\n    this.element = element\n  }\n\n  start() {\n    this.element.addEventListener(\"click\", this.clickBubbled)\n    document.addEventListener(\"turbo:click\", this.linkClicked)\n    document.addEventListener(\"turbo:before-visit\", this.willVisit)\n  }\n\n  stop() {\n    this.element.removeEventListener(\"click\", this.clickBubbled)\n    document.removeEventListener(\"turbo:click\", this.linkClicked)\n    document.removeEventListener(\"turbo:before-visit\", this.willVisit)\n  }\n\n  clickBubbled = (event: Event) => {\n    if (this.respondsToEventTarget(event.target)) {\n      this.clickEvent = event\n    } else {\n      delete this.clickEvent\n    }\n  }\n\n  linkClicked = <EventListener>((event: CustomEvent) => {\n    if (this.clickEvent && this.respondsToEventTarget(event.target) && event.target instanceof Element) {\n      if (this.delegate.shouldInterceptLinkClick(event.target, event.detail.url)) {\n        this.clickEvent.preventDefault()\n        event.preventDefault()\n        this.delegate.linkClickIntercepted(event.target, event.detail.url)\n      }\n    }\n    delete this.clickEvent\n  })\n\n  willVisit = () => {\n    delete this.clickEvent\n  }\n\n  respondsToEventTarget(target: EventTarget | null) {\n    const element\n      = target instanceof Element\n      ? target\n        : target instanceof Node\n        ? target.parentElement\n          : null\n    return element && element.closest(\"turbo-frame, html\") == this.element\n  }\n}\n","import { FrameElement, FrameElementDelegate, FrameLoadingStyle } from \"../../elements/frame_element\"\nimport { FetchMethod, FetchRequest, FetchRequestDelegate } from \"../../http/fetch_request\"\nimport { FetchResponse } from \"../../http/fetch_response\"\nimport { AppearanceObserver, AppearanceObserverDelegate } from \"../../observers/appearance_observer\"\nimport { nextAnimationFrame } from \"../../util\"\nimport { FormSubmission, FormSubmissionDelegate } from \"../drive/form_submission\"\nimport { Locatable, Location } from \"../location\"\nimport { FormInterceptor, FormInterceptorDelegate } from \"./form_interceptor\"\nimport { LinkInterceptor, LinkInterceptorDelegate } from \"./link_interceptor\"\n\nexport class FrameController implements AppearanceObserverDelegate, FetchRequestDelegate, FormInterceptorDelegate, FormSubmissionDelegate, FrameElementDelegate, LinkInterceptorDelegate {\n  readonly element: FrameElement\n  readonly appearanceObserver: AppearanceObserver\n  readonly linkInterceptor: LinkInterceptor\n  readonly formInterceptor: FormInterceptor\n  loadingURL?: string\n  formSubmission?: FormSubmission\n  private resolveVisitPromise = () => {}\n\n  constructor(element: FrameElement) {\n    this.element = element\n    this.appearanceObserver = new AppearanceObserver(this, this.element)\n    this.linkInterceptor = new LinkInterceptor(this, this.element)\n    this.formInterceptor = new FormInterceptor(this, this.element)\n  }\n\n  connect() {\n    if (this.loadingStyle == FrameLoadingStyle.lazy) {\n      this.appearanceObserver.start()\n    }\n    this.linkInterceptor.start()\n    this.formInterceptor.start()\n  }\n\n  disconnect() {\n    this.appearanceObserver.stop()\n    this.linkInterceptor.stop()\n    this.formInterceptor.stop()\n  }\n\n  sourceURLChanged() {\n    if (this.loadingStyle == FrameLoadingStyle.eager) {\n      this.loadSourceURL()\n    }\n  }\n\n  loadingStyleChanged() {\n    if (this.loadingStyle == FrameLoadingStyle.lazy) {\n      this.appearanceObserver.start()\n    } else {\n      this.appearanceObserver.stop()\n      this.loadSourceURL()\n    }\n  }\n\n  async loadSourceURL() {\n    if (this.isActive && this.sourceURL && this.sourceURL != this.loadingURL) {\n      try {\n        this.loadingURL = this.sourceURL\n        this.element.loaded = this.visit(this.sourceURL)\n        this.appearanceObserver.stop()\n        await this.element.loaded\n      } finally {\n        delete this.loadingURL\n      }\n    }\n  }\n\n  async loadResponse(response: FetchResponse): Promise<void> {\n    const fragment = fragmentFromHTML(await response.responseHTML)\n    if (fragment) {\n      const element = await this.extractForeignFrameElement(fragment)\n      await nextAnimationFrame()\n      this.loadFrameElement(element)\n      this.scrollFrameIntoView(element)\n      await nextAnimationFrame()\n      this.focusFirstAutofocusableElement()\n    }\n  }\n\n  // Appearance observer delegate\n\n  elementAppearedInViewport(element: Element) {\n    this.loadSourceURL()\n  }\n\n  // Link interceptor delegate\n\n  shouldInterceptLinkClick(element: Element, url: string) {\n    return this.shouldInterceptNavigation(element)\n  }\n\n  linkClickIntercepted(element: Element, url: string) {\n    this.navigateFrame(element, url)\n  }\n\n  // Form interceptor delegate\n\n  shouldInterceptFormSubmission(element: HTMLFormElement) {\n    return this.shouldInterceptNavigation(element)\n  }\n\n  formSubmissionIntercepted(element: HTMLFormElement, submitter?: HTMLElement) {\n    if (this.formSubmission) {\n      this.formSubmission.stop()\n    }\n\n    this.formSubmission = new FormSubmission(this, element, submitter)\n    if (this.formSubmission.fetchRequest.isIdempotent) {\n      this.navigateFrame(element, this.formSubmission.fetchRequest.url)\n    } else {\n      this.formSubmission.start()\n    }\n  }\n\n  // Fetch request delegate\n\n  additionalHeadersForRequest(request: FetchRequest) {\n    return { \"Turbo-Frame\": this.id }\n  }\n\n  requestStarted(request: FetchRequest) {\n    this.element.setAttribute(\"busy\", \"\")\n  }\n\n  requestPreventedHandlingResponse(request: FetchRequest, response: FetchResponse) {\n    this.resolveVisitPromise()\n  }\n\n  async requestSucceededWithResponse(request: FetchRequest, response: FetchResponse) {\n    await this.loadResponse(response)\n    this.resolveVisitPromise()\n  }\n\n  requestFailedWithResponse(request: FetchRequest, response: FetchResponse) {\n    console.error(response)\n    this.resolveVisitPromise()\n  }\n\n  requestErrored(request: FetchRequest, error: Error) {\n    console.error(error)\n    this.resolveVisitPromise()\n  }\n\n  requestFinished(request: FetchRequest) {\n    this.element.removeAttribute(\"busy\")\n  }\n\n  // Form submission delegate\n\n  formSubmissionStarted(formSubmission: FormSubmission) {\n\n  }\n\n  formSubmissionSucceededWithResponse(formSubmission: FormSubmission, response: FetchResponse) {\n    const frame = this.findFrameElement(formSubmission.formElement)\n    frame.delegate.loadResponse(response)\n  }\n\n  formSubmissionFailedWithResponse(formSubmission: FormSubmission, fetchResponse: FetchResponse) {\n    this.element.delegate.loadResponse(fetchResponse)\n  }\n\n  formSubmissionErrored(formSubmission: FormSubmission, error: Error) {\n\n  }\n\n  formSubmissionFinished(formSubmission: FormSubmission) {\n\n  }\n\n  // Private\n\n  private async visit(url: Locatable) {\n    const location = Location.wrap(url)\n    const request = new FetchRequest(this, FetchMethod.get, location)\n\n    return new Promise<void>(resolve => {\n      this.resolveVisitPromise = () => {\n        this.resolveVisitPromise = () => {}\n        resolve()\n      }\n      request.perform()\n    })\n  }\n\n  private navigateFrame(element: Element, url: string) {\n    const frame = this.findFrameElement(element)\n    frame.src = url\n  }\n\n  private findFrameElement(element: Element) {\n    const id = element.getAttribute(\"data-turbo-frame\")\n    return getFrameElementById(id) ?? this.element\n  }\n\n  private async extractForeignFrameElement(container: ParentNode): Promise<FrameElement> {\n    let element\n    const id = CSS.escape(this.id)\n\n    if (element = activateElement(container.querySelector(`turbo-frame#${id}`))) {\n      return element\n    }\n\n    if (element = activateElement(container.querySelector(`turbo-frame[src][recurse~=${id}]`))) {\n      await element.loaded\n      return await this.extractForeignFrameElement(element)\n    }\n\n    console.error(`Response has no matching <turbo-frame id=\"${id}\"> element`)\n    return new FrameElement()\n  }\n\n  private loadFrameElement(frameElement: FrameElement) {\n    const destinationRange = document.createRange()\n    destinationRange.selectNodeContents(this.element)\n    destinationRange.deleteContents()\n\n    const sourceRange = frameElement.ownerDocument?.createRange()\n    if (sourceRange) {\n      sourceRange.selectNodeContents(frameElement)\n      this.element.appendChild(sourceRange.extractContents())\n    }\n  }\n\n  private focusFirstAutofocusableElement(): boolean {\n    const element = this.firstAutofocusableElement\n    if (element) {\n      element.focus()\n      return true\n    }\n    return false\n  }\n\n  private scrollFrameIntoView(frame: FrameElement): boolean {\n    if (this.element.autoscroll || frame.autoscroll) {\n      const element = this.element.firstElementChild\n      const block = readScrollLogicalPosition(this.element.getAttribute(\"data-autoscroll-block\"), \"end\")\n\n      if (element) {\n        element.scrollIntoView({ block })\n        return true\n      }\n    }\n    return false\n  }\n\n  private shouldInterceptNavigation(element: Element) {\n    const id = element.getAttribute(\"data-turbo-frame\") || this.element.getAttribute(\"target\")\n\n    if (!this.enabled || id == \"_top\") {\n      return false\n    }\n\n    if (id) {\n      const frameElement = getFrameElementById(id)\n      if (frameElement) {\n        return !frameElement.disabled\n      }\n    }\n\n    return true\n  }\n\n  // Computed properties\n\n  get firstAutofocusableElement(): HTMLElement | null {\n    const element = this.element.querySelector(\"[autofocus]\")\n    return element instanceof HTMLElement ? element : null\n  }\n\n  get id() {\n    return this.element.id\n  }\n\n  get enabled() {\n    return !this.element.disabled\n  }\n\n  get sourceURL() {\n    return this.element.src\n  }\n\n  get loadingStyle() {\n    return this.element.loading\n  }\n\n  get isLoading() {\n    return this.formSubmission !== undefined || this.loadingURL !== undefined\n  }\n\n  get isActive() {\n    return this.element.isActive\n  }\n}\n\nfunction getFrameElementById(id: string | null) {\n  if (id != null) {\n    const element = document.getElementById(id)\n    if (element instanceof FrameElement) {\n      return element\n    }\n  }\n}\n\nfunction readScrollLogicalPosition(value: string | null, defaultValue: ScrollLogicalPosition): ScrollLogicalPosition {\n  if (value == \"end\" || value == \"start\" || value == \"center\" || value == \"nearest\") {\n    return value\n  } else {\n    return defaultValue\n  }\n}\n\nfunction fragmentFromHTML(html?: string) {\n  if (html) {\n    const foreignDocument = document.implementation.createHTMLDocument()\n    return foreignDocument.createRange().createContextualFragment(html)\n  }\n}\n\nfunction activateElement(element: Node | null) {\n  if (element && element.ownerDocument !== document) {\n    element = document.importNode(element, true)\n  }\n\n  if (element instanceof FrameElement) {\n    return element\n  }\n}\n","import { StreamElement } from \"../../elements/stream_element\"\n\nexport const StreamActions: { [action: string]: (this: StreamElement) => void } = {\n  append() {\n    this.targetElement?.append(this.templateContent)\n  },\n\n  prepend() {\n    this.targetElement?.prepend(this.templateContent)\n  },\n\n  remove() {\n    this.targetElement?.remove()\n  },\n\n  replace() {\n    this.targetElement?.replaceWith(this.templateContent)\n  },\n\n  update() {\n    if (this.targetElement) {\n      this.targetElement.innerHTML = \"\"\n      this.targetElement.append(this.templateContent)\n    }\n  }\n}\n","import { StreamActions } from \"../core/streams/stream_actions\"\nimport { nextAnimationFrame } from \"../util\"\n\n// <turbo-stream action=replace target=id><template>...\n\nexport class StreamElement extends HTMLElement {\n  async connectedCallback() {\n    try {\n      await this.render()\n    } catch (error) {\n      console.error(error)\n    } finally {\n      this.disconnect()\n    }\n  }\n\n  private renderPromise?: Promise<void>\n\n  async render() {\n    return this.renderPromise ??= (async () => {\n      if (this.dispatchEvent(this.beforeRenderEvent)) {\n        await nextAnimationFrame()\n        this.performAction()\n      }\n    })()\n  }\n\n  disconnect() {\n    try { this.remove() } catch {}\n  }\n\n  get performAction() {\n    if (this.action) {\n      const actionFunction = StreamActions[this.action]\n      if (actionFunction) {\n        return actionFunction\n      }\n      this.raise(\"unknown action\")\n    }\n    this.raise(\"action attribute is missing\")\n  }\n\n  get targetElement() {\n    if (this.target) {\n      return this.ownerDocument?.getElementById(this.target)\n    }\n    this.raise(\"target attribute is missing\")\n  }\n\n  get templateContent() {\n    return this.templateElement.content\n  }\n\n  get templateElement() {\n    if (this.firstElementChild instanceof HTMLTemplateElement) {\n      return this.firstElementChild\n    }\n    this.raise(\"first child element must be a <template> element\")\n  }\n\n  get action() {\n    return this.getAttribute(\"action\")\n  }\n\n  get target() {\n    return this.getAttribute(\"target\")\n  }\n\n  private raise(message: string): never {\n    throw new Error(`${this.description}: ${message}`)\n  }\n\n  private get description() {\n    return (this.outerHTML.match(/<[^>]+>/) ?? [])[0] ?? \"<turbo-stream>\"\n  }\n\n  private get beforeRenderEvent() {\n    return new CustomEvent(\"turbo:before-stream-render\", { bubbles: true, cancelable: true })\n  }\n}\n","import { FrameController } from \"../core/frames/frame_controller\"\nimport { FrameElement } from \"./frame_element\"\nimport { StreamElement } from \"./stream_element\"\n\nFrameElement.delegateConstructor = FrameController\n\nexport * from \"./frame_element\"\nexport * from \"./stream_element\"\n\ncustomElements.define(\"turbo-frame\", FrameElement)\ncustomElements.define(\"turbo-stream\", StreamElement)\n","import intern from \"intern\"\nimport Test from \"intern/lib/Test\"\nimport { Tests } from \"intern/lib/interfaces/object\"\n\nexport class InternTestCase {\n  readonly internTest: Test\n\n  static registerSuite() {\n    return intern.getInterface(\"object\").registerSuite(this.name, { tests: this.tests })\n  }\n\n  static get tests(): Tests {\n    return this.testNames.reduce((tests, testName): Tests => {\n      return { ...tests, [testName]: internTest => this.runTest(internTest) }\n    }, {} as Tests)\n  }\n\n  static get testNames(): string[] {\n    return this.testKeys.map(key => key.slice(5))\n  }\n\n  static get testKeys(): string[] {\n    return Object.getOwnPropertyNames(this.prototype).filter(key => key.match(/^test /))\n  }\n\n  static runTest(internTest: Test): Promise<void> {\n    const testCase = new this(internTest)\n    return testCase.runTest()\n  }\n\n  constructor(internTest: Test) {\n    this.internTest = internTest\n  }\n\n  get testName() {\n    return this.internTest.name\n  }\n\n  async runTest() {\n    try {\n      await this.setup()\n      await this.beforeTest()\n      await this.test()\n      await this.afterTest()\n    } finally {\n      await this.teardown()\n    }\n  }\n\n  get assert() {\n    return intern.getPlugin(\"chai\").assert\n  }\n\n  async setup() {\n\n  }\n\n  async beforeTest() {\n\n  }\n\n  get test(): () => Promise<void> {\n    const method = (this as any)[`test ${this.testName}`]\n    if (method != null && typeof method == \"function\") {\n      return method\n    } else {\n      throw new Error(`No such test \"${this.testName}\"`)\n    }\n  }\n\n  async afterTest() {\n\n  }\n\n  async teardown() {\n\n  }\n}\n","import { InternTestCase } from \"./intern_test_case\"\n\nexport class DOMTestCase extends InternTestCase {\n  fixtureElement = document.createElement(\"main\")\n\n  async setup() {\n    this.fixtureElement.hidden = true\n    document.body.insertAdjacentElement(\"afterbegin\", this.fixtureElement)\n  }\n\n  async teardown() {\n    this.fixtureElement.innerHTML = \"\"\n    this.fixtureElement.remove()\n  }\n\n  append(node: Node) {\n    this.fixtureElement.appendChild(node)\n  }\n\n  find(selector: string) {\n    return this.fixtureElement.querySelector(selector)\n  }\n\n  get fixtureHTML() {\n    return this.fixtureElement.innerHTML\n  }\n\n  set fixtureHTML(html: string) {\n    this.fixtureElement.innerHTML = html\n  }\n}\n","import { StreamElement } from \"../../elements\"\nimport { nextAnimationFrame } from \"../../util\"\nimport { DOMTestCase } from \"../helpers/dom_test_case\"\n\nexport class StreamElementTests extends DOMTestCase {\n  async beforeTest() {\n    this.fixtureHTML = `<div id=\"hello\">Hello Turbo</div>`\n  }\n\n  async \"test action=append\"() {\n    const element = createStreamElement(\"append\", \"hello\", createTemplateElement(\" Streams\"))\n    this.assert.equal(this.find(\"#hello\")?.textContent, \"Hello Turbo\")\n\n    this.append(element)\n    await nextAnimationFrame()\n\n    this.assert.equal(this.find(\"#hello\")?.textContent, \"Hello Turbo Streams\")\n    this.assert.isNull(element.parentElement)\n  }\n\n  async \"test action=prepend\"() {\n    const element = createStreamElement(\"prepend\", \"hello\", createTemplateElement(\"Streams \"))\n    this.assert.equal(this.find(\"#hello\")?.textContent, \"Hello Turbo\")\n\n    this.append(element)\n    await nextAnimationFrame()\n\n    this.assert.equal(this.find(\"#hello\")?.textContent, \"Streams Hello Turbo\")\n    this.assert.isNull(element.parentElement)\n  }\n\n  async \"test action=remove\"() {\n    const element = createStreamElement(\"remove\", \"hello\")\n    this.assert.ok(this.find(\"#hello\"))\n\n    this.append(element)\n    await nextAnimationFrame()\n\n    this.assert.notOk(this.find(\"#hello\"))\n    this.assert.isNull(element.parentElement)\n  }\n\n  async \"test action=replace\"() {\n    const element = createStreamElement(\"replace\", \"hello\", createTemplateElement(`<h1 id=\"hello\">Hello Turbo</h1>`))\n    this.assert.equal(this.find(\"#hello\")?.textContent, \"Hello Turbo\")\n    this.assert.ok(this.find(\"div#hello\"))\n\n    this.append(element)\n    await nextAnimationFrame()\n\n    this.assert.equal(this.find(\"#hello\")?.textContent, \"Hello Turbo\")\n    this.assert.notOk(this.find(\"div#hello\"))\n    this.assert.ok(this.find(\"h1#hello\"))\n    this.assert.isNull(element.parentElement)\n  }\n\n  async \"test action=update\"() {\n    const element = createStreamElement(\"update\", \"hello\", createTemplateElement(\"Goodbye Turbo\"))\n    this.assert.equal(this.find(\"#hello\")?.textContent, \"Hello Turbo\")\n\n    this.append(element)\n    await nextAnimationFrame()\n\n    this.assert.equal(this.find(\"#hello\")?.textContent, \"Goodbye Turbo\")\n    this.assert.isNull(element.parentElement)\n  }\n}\n\nfunction createStreamElement(action: string | null, target: string | null, templateElement?: HTMLTemplateElement) {\n  const element = new StreamElement()\n  if (action) element.setAttribute(\"action\", action)\n  if (target) element.setAttribute(\"target\", target)\n  if (templateElement) element.appendChild(templateElement)\n  return element\n}\n\nfunction createTemplateElement(html: string) {\n  const element = document.createElement(\"template\")\n  element.innerHTML = html\n  return element\n}\n\nStreamElementTests.registerSuite()\n"],"names":["intern"],"mappings":"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"}